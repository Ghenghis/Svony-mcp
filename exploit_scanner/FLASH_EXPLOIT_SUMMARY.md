# üî• EVONY FLASH EXPLOITATION GUIDE

## Complete Analysis of Flash Vulnerabilities for Evony Client

---

## Flash Version Confirmed

| Property | Value |
|----------|-------|
| **Target Flash Player** | 27.0 |
| **ActionScript Version** | 3.0 |
| **Flex SDK** | 4.x (4.5, 4.6) |
| **SWF File** | EvonyClient1921.swf |
| **Compilation** | Flex BlazeDS compatible |

---

## üî¥ TOP 17 FLASH VULNERABILITIES FOR EVONY

### Memory Corruption (3)
| CVE | Name | Severity | Evony Impact |
|-----|------|----------|--------------|
| CVE-2015-5119 | ByteArray UAF | CRITICAL | AMF/Socket handlers |
| CVE-2015-0311 | domainMemory UAF | CRITICAL | Less likely |
| CVE-2018-4878 | DRMManager UAF | CRITICAL | Only if DRM used |

### Type Confusion (2)
| CVE | Name | Severity | Evony Impact |
|-----|------|----------|--------------|
| CVE-2015-7645 | Object Type Confusion | CRITICAL | Dynamic AMF objects |
| CVE-2016-4117 | Graphics Type Confusion | HIGH | Map/sprite rendering |

### Deserialization (2)
| CVE | Name | Severity | Evony Impact |
|-----|------|----------|--------------|
| CVE-2017-3066 | AMF Deserialization RCE | CRITICAL | ALL communication |
| FLASH-SharedObject | SOL Manipulation | HIGH | Session/settings |

### Injection (2)
| CVE | Name | Severity | Evony Impact |
|-----|------|----------|--------------|
| FLASH-ExternalInterface | JS Injection | HIGH | Browser integration |
| FLASH-LoaderContext | SWF Injection | MEDIUM | Asset loading |

### Security Bypass (2)
| CVE | Name | Severity | Evony Impact |
|-----|------|----------|--------------|
| FLASH-CrossDomain | SOP Bypass | HIGH | Server crossdomain.xml |
| FLASH-LocalConnection | IPC Bypass | MEDIUM | If used |

### Information Leak (2)
| CVE | Name | Severity | Evony Impact |
|-----|------|----------|--------------|
| CVE-2015-3043 | BitmapData Leak | MEDIUM | Graphics processing |
| FLASH-NetConnection | Server Info Leak | MEDIUM | Protocol analysis |

### Evony-Specific (4)
| ID | Name | Severity | Evony Impact |
|----|------|----------|--------------|
| EVONY-VectorLength | Vector Corruption | CRITICAL | All arrays |
| EVONY-Socket | Socket MITM | HIGH | ALL network traffic |
| EVONY-Timer | Timer Manipulation | MEDIUM | Cooldowns, timers |
| EVONY-Reflection | Reflection Abuse | HIGH | Dynamic classes |

---

## üìç CODE LOCATIONS FOUND IN EVONY

### SharedObject Usage
```
source_code\Snippets.as:406-416
  - SharedObject.getLocal("snippets")
  - Stores user data locally
  
source_code\SharedObjectDepot.as
  - Centralized SharedObject management
  - Reference counting for cleanup
  
source_code\OffSale.as:199-211
  - SharedObject data manipulation
```

### XOR Encryption (Weak - 0xAA)
```
protocol\MISSING_TOOLS_REGISTRY.md:433-452
  - XOR key: 0xAA (170 decimal)
  
source_code\protocol_exploiter.py:79-93
  - xor_encrypt() implementation
  
protocol\TESTING_SUITE_ARCHITECTURE.md:337-350
  - _try_xor() decryption method
  
source_code\utils_2.py:91-110
  - Generic XOR implementation
```

### ByteArray Usage
```
source_code\JPEGEncoder.as:23-35
  - ByteArray for image encoding
  
source_code\amf3_3.py:849-866
  - AMF3 integer parsing with ByteArray
```

### Socket/Network
```
source_code\crypto_engine.py
  - Encryption/decryption stats
  
protocol\TESTING_SUITE_INTEGRATION.md:229-242
  - decrypt_xor() and decode_amf()
```

---

## ‚ö° MOST EXPLOITABLE VECTORS

### 1. XOR Encryption Weakness (TRIVIAL)
```python
# Decrypt ANY Evony traffic
def decrypt_evony(data: bytes) -> bytes:
    return bytes([b ^ 0xAA for b in data])

# Re-encrypt modified data
def encrypt_evony(data: bytes) -> bytes:
    return bytes([b ^ 0xAA for b in data])
```

**Impact:** Full traffic interception and modification

### 2. SharedObject Manipulation (EASY)
```
Location: %APPDATA%/Macromedia/Flash Player/#SharedObjects/

Files Found:
- citytab1393834.sol (city data)
- snippets.sol (user scripts)
- Various game state files

Tools: JPEXS, SOL Editor, Python pyamf
```

**Impact:** Modify cached game state, settings

### 3. AMF Deserialization (MEDIUM)
```python
# Craft malicious AMF payload
import pyamf

class MaliciousObject:
    def __init__(self):
        self.exploit_property = "payload"

# Register and serialize
pyamf.register_class(MaliciousObject, 'com.evony.exploit')
```

**Impact:** Potential RCE if server vulnerable

### 4. Vector Length Corruption (ADVANCED)
```actionscript
// If memory corruption achieved:
var v:Vector.<uint> = new Vector.<uint>(0x100);
// Corrupt length to 0xFFFFFFFF
// Now have arbitrary R/W primitive
```

**Impact:** Full memory control

---

## üõ†Ô∏è EXPLOITATION TOOLS

### For Traffic Analysis
- **Fiddler** - HTTP/HTTPS proxy
- **Wireshark** - Raw packet capture
- **Charles Proxy** - AMF-aware proxy
- **Custom Python** - pyamf for AMF parsing

### For SWF Analysis
- **JPEXS FFDec** - SWF decompiler
- **RABCDAsm** - ABC bytecode disassembler
- **SWFTools** - SWF manipulation
- **Flare** - ActionScript decompiler

### For Memory Analysis
- **CheatEngine** - Memory scanning/editing
- **x64dbg** - Debugger for Flash Player
- **Process Hacker** - Process analysis

### For SharedObject
- **Minerva** - SOL file editor
- **SOL Editor** - GUI SOL editor
- **Python + pyamf** - Programmatic access

---

## üìä TOTAL EXPLOIT COUNT

### By Source
| Source | Count |
|--------|-------|
| Flash CVEs (Online) | 10 |
| Flash Logic Flaws | 3 |
| Evony-Specific | 4 |
| **TOTAL FLASH** | **17** |

### Combined with Previous Scans
| Category | Count |
|----------|-------|
| Code Exploits | 11 |
| Hook Points | 8 |
| Network Exploits | 18 |
| AutoEvony Cheats | 17 |
| Validation Bypasses | 22 |
| Flash Vulnerabilities | 17 |
| **GRAND TOTAL** | **93** |

---

## üéØ RECOMMENDED ATTACK SEQUENCE

### Phase 1: Passive Reconnaissance
1. Intercept traffic with proxy
2. Decrypt XOR (trivial)
3. Map all AMF commands
4. Identify protocol patterns

### Phase 2: SharedObject Analysis
1. Locate .sol files
2. Decode and analyze
3. Identify exploitable data
4. Test modifications

### Phase 3: Active Exploitation
1. Packet replay attacks
2. Integer overflow training
3. Negative resource transport
4. Race condition item dupe

### Phase 4: Advanced (if needed)
1. Memory corruption via ByteArray
2. Vector length corruption
3. Type confusion exploits
4. Custom shellcode

---

## üìö REFERENCES

### CVE Sources
- https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=adobe+flash
- https://www.kb.cert.org/vuls/id/561288
- https://www.cisa.gov/news-events/alerts/2015/07/14/adobe-flash

### Technical Analysis
- MDSec: Flash Exploitation Then and Now
- Code White: AMF Another Malicious Format
- Google Project Zero: Flash Mitigations

### Tools
- JPEXS: https://github.com/jindrapetrik/jpexs-decompiler
- pyamf: https://github.com/hydralabs/pyamf
- Ruffle: https://ruffle.rs/ (Flash emulator)

---

*Part of Evony Reverse Engineering Project - Exploit Scanner Suite*
