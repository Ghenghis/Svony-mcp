[
  {
    "name": "Integer Overflow Troop Training",
    "category": "integer_overflow",
    "severity": "critical",
    "description": "Training massive troops causes integer overflow, resulting in free/negative cost",
    "location": "com/evony/client/action/TroopCommands.as",
    "code_pattern": "num * cost > INT32_MAX",
    "exploit_method": "\n1. Calculate overflow threshold: INT32_MAX / troop_food_cost + 1\n2. Train that exact number of troops\n3. Cost wraps to negative, giving free troops or resources\n\nThresholds:\n- Archer (350 food): 6,135,037 troops\n- Worker (50 food): 42,949,673 troops  \n- Catapult (3000 food): 715,828 troops\n",
    "requirements": [
      "Sufficient barracks capacity",
      "Population available"
    ],
    "detection_risk": "LOW - Server may not validate overflow",
    "proof_of_concept": "train a:6135037",
    "cross_references": [
      "food_flip",
      "resource_overflow",
      "com/evony/Context.as:timerHandler"
    ]
  },
  {
    "name": "Food Flip Glitch",
    "category": "integer_overflow",
    "severity": "critical",
    "description": "Negative food consumption flips to massive positive",
    "location": "com/evony/Context.as:timerHandler",
    "code_pattern": "food.amount = base + (increaseRate - troopCostFood)",
    "exploit_method": "\n1. Build massive army to increase troopCostFood\n2. Let food go negative (overflow)\n3. Negative value wraps to INT32_MAX\n4. Instant billions of food\n",
    "requirements": [
      "Large army",
      "Low food production"
    ],
    "detection_risk": "MEDIUM - Abnormal resource values",
    "proof_of_concept": "Build 10M+ archers, wait for food tick",
    "cross_references": [
      "troop_overflow",
      "resource_calc",
      "com/evony/client/action/TroopCommands.as"
    ]
  },
  {
    "name": "Race Condition Item Duplication",
    "category": "race_condition",
    "severity": "high",
    "description": "Rapid item use before server confirms consumption",
    "location": "com/evony/client/action/ItemCommands.as",
    "code_pattern": "sendMessage before wait for response",
    "exploit_method": "\n1. Send item.useItem command\n2. Immediately send again before response\n3. Client allows both, server may process both\n4. Item duplicated or effect stacked\n",
    "requirements": [
      "Fast connection",
      "Timing precision"
    ],
    "detection_risk": "MEDIUM - Rapid duplicate requests",
    "proof_of_concept": "Rapid-fire useItem with same itemId",
    "cross_references": [
      "packet_replay",
      "command_flood"
    ]
  },
  {
    "name": "Client-Side Validation Only",
    "category": "validation_bypass",
    "severity": "high",
    "description": "Many checks only exist on client, server trusts client",
    "location": "com/evony/SenderImpl.as",
    "code_pattern": "if (bVisitor || getCurCastle() == null) return",
    "exploit_method": "\n1. Intercept sendMessage calls\n2. Bypass client-side checks\n3. Send commands that client would block\n4. Server may accept without validation\n\nBypassable checks:\n- Visitor restrictions\n- Resource requirements\n- Cooldown timers\n- Building requirements\n",
    "requirements": [
      "Packet interception tool",
      "Protocol knowledge"
    ],
    "detection_risk": "LOW - Server often trusts client",
    "proof_of_concept": "Send upgrade command without resources",
    "cross_references": [
      "packet_injection",
      "proxy_modify",
      "army.newArmy params"
    ]
  },
  {
    "name": "Negative Resource Transfer",
    "category": "validation_bypass",
    "severity": "high",
    "description": "Sending negative resources in transport gives to sender",
    "location": "army.newArmy params",
    "code_pattern": "resource string not validated for negative",
    "exploit_method": "\n1. Create transport army\n2. Set resource values as negative: \"-1000000,-1000000,...\"\n3. Server may interpret as giving resources TO you\n4. Drain target's resources\n",
    "requirements": [
      "Target coordinates",
      "Transport capability"
    ],
    "detection_risk": "MEDIUM - Unusual resource values",
    "proof_of_concept": "transport 100,200 r:-1000000,-1000000,0,0,0",
    "cross_references": [
      "parameter_injection",
      "type_confusion",
      "com/evony/SenderImpl.as"
    ]
  },
  {
    "name": "Session Replay Attack",
    "category": "network_exploit",
    "severity": "medium",
    "description": "Captured packets can be replayed",
    "location": "Network layer",
    "code_pattern": "No nonce/timestamp validation",
    "exploit_method": "\n1. Capture successful command packet\n2. Save packet bytes\n3. Replay same packet later\n4. Action repeats if server doesn't track\n\nBest targets:\n- Resource collection\n- Item usage\n- Troop training\n",
    "requirements": [
      "Packet capture tool",
      "Understanding of AMF"
    ],
    "detection_risk": "LOW - Identical packets common",
    "proof_of_concept": "Capture train command, replay 10x",
    "cross_references": [
      "packet_capture",
      "amf_decode"
    ]
  },
  {
    "name": "Timer Manipulation",
    "category": "timing_attack",
    "severity": "medium",
    "description": "Client-side timers can be manipulated",
    "location": "com/evony/Context.as:timerHandler",
    "code_pattern": "timer.start() with local time",
    "exploit_method": "\n1. Hook Flash timer functions\n2. Accelerate timer callbacks\n3. Client thinks more time passed\n4. Cooldowns expire faster locally\n\nAffects:\n- Building queue display\n- March time estimates\n- Resource accumulation display\n",
    "requirements": [
      "Flash debugging tools",
      "Memory editing"
    ],
    "detection_risk": "LOW - Only affects display",
    "proof_of_concept": "CheatEngine to speed up timer",
    "cross_references": [
      "memory_edit",
      "client_hook"
    ]
  },
  {
    "name": "Weak XOR Encryption",
    "category": "crypto_weakness",
    "severity": "medium",
    "description": "XOR with single byte key is trivially reversible",
    "location": "Protocol encryption layer",
    "code_pattern": "data XOR 0xAA",
    "exploit_method": "\n1. Capture encrypted packet\n2. XOR all bytes with 0xAA\n3. Plaintext revealed\n4. Modify and re-encrypt\n\nKey: 0xAA (170 decimal)\n",
    "requirements": [
      "Packet capture"
    ],
    "detection_risk": "NONE - Just reading",
    "proof_of_concept": "bytes([b ^ 0xAA for b in packet])",
    "cross_references": [
      "packet_decode",
      "crypto_keys",
      "Request signing"
    ]
  },
  {
    "name": "Predictable Request Signature",
    "category": "crypto_weakness",
    "severity": "high",
    "description": "MD5 signature uses known static key",
    "location": "Request signing",
    "code_pattern": "MD5(params + ACTION_KEY)",
    "exploit_method": "\n1. Know ACTION_KEY (extracted)\n2. Construct any params string\n3. Calculate MD5(params + ACTION_KEY)\n4. Send with valid signature\n\nACTION_KEY: \"TAO_{313-894*&*($*#-FDIU(430}-{facebook_dioe(&*%$l}\"\n",
    "requirements": [
      "ACTION_KEY (known)"
    ],
    "detection_risk": "NONE - Valid signatures",
    "proof_of_concept": "hashlib.md5(params + ACTION_KEY).hexdigest()",
    "cross_references": [
      "request_forge",
      "key_extraction",
      "Protocol encryption layer"
    ]
  },
  {
    "name": "Dynamic Object Injection",
    "category": "injection",
    "severity": "high",
    "description": "Dynamic AS3 objects allow property injection",
    "location": "AMF deserialization",
    "code_pattern": "obj[prop] = value with dynamic class",
    "exploit_method": "\n1. Craft AMF response with extra properties\n2. Dynamic objects accept any property\n3. Inject unexpected values\n4. May override internal state\n\nTargets:\n- PlayerBean\n- CastleBean\n- TroopBean (add fake troops)\n",
    "requirements": [
      "AMF crafting capability",
      "MITM position"
    ],
    "detection_risk": "MEDIUM - Unusual properties",
    "proof_of_concept": "Add 'gold.amount': 999999999 to response",
    "cross_references": [
      "amf_craft",
      "response_inject"
    ]
  },
  {
    "name": "ExternalInterface Hook",
    "category": "hook_point",
    "severity": "high",
    "description": "Flash ExternalInterface allows JavaScript injection",
    "location": "ExternalInterface.call usage",
    "code_pattern": "ExternalInterface.addCallback",
    "exploit_method": "\n1. Load game in controlled browser\n2. Override ExternalInterface callbacks\n3. Intercept all Flash-JS communication\n4. Modify data in transit\n\nHookable functions found in client.\n",
    "requirements": [
      "Browser control",
      "JavaScript access"
    ],
    "detection_risk": "LOW - Client-side only",
    "proof_of_concept": "Override window.__flash__* functions",
    "cross_references": [
      "js_bridge",
      "browser_hook"
    ]
  }
]